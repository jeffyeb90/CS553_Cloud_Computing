#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <math.h>
#include <float.h>
#include <limits.h>
#include <sys/time.h>
#include <string.h>

#ifndef BSIZE
#    define BSIZE 1000000000
#endif

#ifndef TSIZE
#    define TSIZE 1000000000
#endif

#ifndef NTIME
#   define NTIME 10
#endif

double getCurrentTime()
{
    struct timeval tp;
    struct timezone tzp;
    int i;

    i = gettimeofday(&tp,&tzp);

    return ( (double) tp.tv_sec + (double) tp.tv_usec * 1.e-6 );
}


int main()
{
    int timeToRun = 0;

    double before;
    double after;
    double interval;

    interval = 0.0;
    
    int i;

    while (timeToRun < NTIME)
    {
        void *source = malloc(TSIZE);
        void *dest = malloc(TSIZE);

        void *soffset;
        void *doffset;

        soffset = source;
        doffset = dest;

        before = getCurrentTime();
     
        memcpy(doffset, soffset, BSIZE);

        after = getCurrentTime();

        interval = interval + (after - before);

        free(source);
        free(dest);

        timeToRun++;
    }

    printf("time intverval is %f\n", interval);

    printf("the throughput is %f MB/s.\n", (double)TSIZE / interval / 1000000);

    return 0;
}
